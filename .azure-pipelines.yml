# https://aka.ms/yaml

trigger:
  tags:
    include:
    - v*
  branches:
    include:
    - develop

variables:
- group: security-tokens

jobs:
  - job: build
    pool: 
      vmImage: 'ubuntu-latest'
    env:
      OPENSSL_KEY: $(openssl.key)
      OPENSSL_IV: $(openssl.iv)
      TOKEN_NPM: $(token.npm)
      TOKEN_NUGET: $(token.nuget)
      TOKEN_CODECOV: $(token.codecov)
    steps:
      - script: |
          bash docker.sh coverage
    displayName: 'Tests and Coverage'
  - job: sbt
    pool: 
      vmImage: 'ubuntu-latest'
    env:
      OPENSSL_KEY: $(openssl.key)
      OPENSSL_IV: $(openssl.iv)
      TOKEN_NPM: $(token.npm)
      TOKEN_NUGET: $(token.nuget)
      TOKEN_CODECOV: $(token.codecov)
    steps:
      - script: |
          bash docker.sh scripted
    displayName: 'SBT plugin tests'
  - job: site
    pool: 
      vmImage: 'ubuntu-latest'
    env:
      OPENSSL_KEY: $(openssl.key)
      OPENSSL_IV: $(openssl.iv)
      TOKEN_NPM: $(token.npm)
      TOKEN_NUGET: $(token.nuget)
      TOKEN_CODECOV: $(token.codecov)
    dependsOn: build
    steps:
      - script: |
          bash docker.sh site
    displayName: 'Publish Site'
  - job: publish
    pool: 
      vmImage: 'ubuntu-latest'
    env:
      OPENSSL_KEY: $(openssl.key)
      OPENSSL_IV: $(openssl.iv)
      TOKEN_NPM: $(token.npm)
      TOKEN_NUGET: $(token.nuget)
      TOKEN_CODECOV: $(token.codecov)
    dependsOn: build
    steps:
      - script: |
          bash docker.sh publish
    displayName: 'Publish to Maven Central'
